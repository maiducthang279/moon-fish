(function(){"use strict";const A=(t,n)=>({x:t.x+n.x,y:t.y+n.y}),w=(t,n)=>({x:t.x-n.x,y:t.y-n.y}),d=(t,n)=>{const e=Math.hypot(t.x,t.y);return{x:t.x/e*n,y:t.y/e*n}},p=(t,n)=>Math.hypot(t.x,t.y)>n?d(t,n):t,f=Math.PI/3,v=(t,n,e)=>{const c=Math.atan2(e.y,e.x),a=[],s=t[0],r=n[0],m=Array.from({length:5},(x,M)=>{const I=Math.PI/3-Math.PI/6*M;return P(r,c+I,s)});a.push(...m);const y=[],o=[];for(let x=1;x<t.length;x++){const M=t[x],I=n[x],X=t[x-1],_=Math.atan2(X.y-M.y,X.x-M.x),Y=P(I,_+Math.PI/2,M),N=P(I,_-Math.PI/2,M);y.push(Y),o.push(N)}const h=t[t.length-1],g=n[n.length-1],l=t[t.length-2],i=Math.atan2(l.y-h.y,l.x-h.x),u=P(g,i+Math.PI,h);return a.push(...o),a.push(u),a.push(...y.reverse()),a},P=(t,n,e)=>({x:e.x+t*Math.cos(n),y:e.y+t*Math.sin(n)}),D=(t,n,e)=>{const{positions:c,velocity:a}=t,s={...c[0]},r=Math.min(n,e)/4,m=Math.floor(performance.now()/1e3%30/10)-1,y=Math.floor(performance.now()/1e3%50/10)-2,o={x:n/2+m*r/4,y:e/2+y*r/8},h={minX:o.x-r,minY:o.y-r,maxX:o.x+r,maxY:o.y+r},g=E(Math.atan2(a.y,a.x)),l=E(Math.atan2(o.y-s.y,o.x-s.x)),i=E(l-g);if(s.x>h.minX&&s.x<h.maxX&&s.y>h.minY&&s.y<h.maxY){const u=Math.hypot(o.x-s.x,o.y-s.y),x=f*(r-u)/r,M=i<Math.PI?x:Math.PI*(2-x);return P(10*2,g-M,s)}if(i<Math.PI/2||i>Math.PI*3/2)return o;if(i>Math.PI/2&&i<Math.PI*3/2){const u=i<Math.PI?f:Math.PI*(2-f);return P(10*2,g+u,s)}return o},F=(t,n,e)=>{const{positions:c,velocity:a}=t,s=D(t,n,e),r=w(s,c[0]),y=p(d(r,10),.5),o=p(A(a,y),10),h=c.map((l,i,u)=>{if(i===0)return A(l,o);const x=u[i-1];return S(l,x)});return{...t,velocity:o,acceleration:y,positions:h,vertex:v(h,t.widths,o)}},S=(t,n,e)=>V(t,n,40),V=(t,n,e)=>{const c=Math.atan2(t.y-n.y,t.x-n.x);return{x:n.x+e*Math.cos(c),y:n.y+e*Math.sin(c)}},E=t=>{const n=Math.PI*2;let e=t;for(;e<0;)e+=n;for(;e>n;)e-=n;return e};self.onmessage=t=>{const{fishes:n,width:e,height:c}=t.data,a=n.map(s=>F(s,e,c));self.postMessage(a)}})();
